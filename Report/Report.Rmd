---
title: 'Predicting Depression Using Machine Learning'
author: "Vivian Dong 300525329, Saumya Sajwan, Samanalie Perera"
classoption: 12pt
output: bookdown::pdf_document2
date: November 1, 2022
bibliography: reference.bib
link-citations: true
biblio_style: "apalike"
---

# Executive Summary

# Background
A study found that depression increased from 9% in 2017–2018 to over 14% in April 2020 among US adults during the COVID-19 pandemic. A study found that depression increased from 9% in 2017–2018 to over 14% in April 2020 among US adults during the COVID-19 pandemic. Among different age groups, the mental health of young adults is most affected by the pandemic. This increased rate was not normal compared to other years, and there was not enough attention paid to data examining tools either. [@depressionStats] Although there is an increasing number of adults with depression, the average treatment cost per individual decreased, which means more and more people have not been able to receive any treatment.[@cost] People who are depressed are also far more likely to be diagnosed with other diseases, such as heart disease, diabetes, and high blood pressure.

There are blood tests, brain scans and other medical examining methods for a depression diagnosis. In the end, the most affected way is to let the patients describe their symptoms. To achieve this, patients can answer a questionnaire like determining the frequency of depression symptoms over the past two weeks. This method may lead to subjective bias and imperfections in the diagnostic capabilities. [@diagnose] However, the cause of depression could be from many other things, such as sleep disorders, drug use, alcohol use and weight loss. For example, if a person has been working in a stressful environment with low income and not enough sleep, that person may have a higher chance than other people to have depression.

Healthcare data from the National Health and Nutrition Examination Survey database includes a wide range of concepts, like health records, genetic information and even demographic data. Furthermore, machine learning tools tend to perform better than humans at processing these big data sets and making use of it.[@bias] 

Our primary goal in this project was to train a machine learning classification model to identify patients who suffer from depression using demographics and healthcare data from the NHANES database.

# Data Description
The NHANES 2005 - March 2020 year range was selected as the data set for this project. We did not go before 2005 because the survey questions were different compared to later years. Demographics, sleep disorders, alcohol use, smoking (cigarette use) and weight history information are used as predictors since they are found to be primary factors for the cause of depression. We manually selected the variables with less than 50% missing rate from these data sets. For our target variable - depression, we used the Mental Health - Depression Screener data sets and PHQ-9 scoring system [@score] to identify whether a person has depression. The final scores of 0–4, 5–9, 10–14, 15–19, and 20–27 are the ranges for none, mild, moderate, moderately severe and severe depression, respectively. In our project, we wanted to focus on building a binary classification model, so if the respondent has a total score that is greater than or equal to 10, then the individual is identified as having depression. 

As a result, we have 29 variables in our data set, including id, depression result, and 27 predictors, including 15 numerical and 12 categorical variables. Table 1 and 2 show the descriptions of data.

| Variable                | Description                                        |
|:------------------------|:---------------------------------------------------|
| id                      | Unique identifier for each respondent              |
| age                     | The age of the respondent                          |
| family_PIR               | Poverty income ratio (PIR) - a ratio of family income to poverty threshold|
| sleep_hours             | Total hours of sleep                               |
| drinks_per_occasion     | Average drinks per day                             |
| SMD030                  | Age started smoking cigarettes regularly           |
| SMD641                  | Number of days smoked cigarettes during the past 30 days|
| SMD650                  | Average number of cigarettes per day during past 30 days|
| SMD630                  | Age first smoked the whole cigarette               |
| WHD010                  | Height of the respondent (inches)                  |
| WHD020                  | Weight of the respondent (pounds)                  |
| WHD050                  | Weight of the respondent (pounds) 1 year ago       |
| WHD110                  | Weight of the respondent (pounds) 10 years ago     |
| WHD120                  | Weight of the respondent (pounds) at the age of 25 |
| WHD140                  | Respondent's heaviest weight (pounds)              |
| WHQ150                  | Age of the respondent when heaviest weight         |

Table: Description of the numerical data

| Variable                | Description                                        |
|:------------------------|:---------------------------------------------------|
| result                  | Whether the respondent has depression (1=Yes, 0=No)|
| gender                  | Gender of respondent                               |
| race                    | Race of respondent                                 |
| marital_status          | The marital status of the respondent               |
| education_level_adults  | Highest level of education of the respondent       |
| language                | Language of the respondent                         |
| trouble_sleeping_history| Whether had trouble sleeping                       |
| SMQ020                  | Whether had smoked at least 100 cigarettes in life |
| SMQ040                  | Frequency of smoking cigarettes                    |
| SMQ670                  | Whether tried to quit smoking                      |
| WHQ030                  | How respondent consider their weight               |
| WHQ040                  | Respondent likes to weigh more, less or the same   |
| WHQ070                  | Whether the respondent tried to lose weight in the past year|

Table: Description of the categorical data

We had 43,928 entries when we first combined all the data sets, but we need the respondent to answer every single question in the Mental Health - Depression Screener Survey to calculate the score. Therefore, we had to remove the respondent who did not complete the survey, which gave us 26,473 data at the end. (17,455 respondents were taken out)

The structure of the missing data in our data set varied from variable to variable, so we had to find the data description for each variable from the NHANES website and convert them to NA. For example, 7, 777 and 7777 could all be refused to answer the survey question; both "-1" and "." mean no answers.

Another problem we had was that the variables in the data set from each year may be different or have different names. We ended up choosing the variables that appeared every year and changing them to have the same names.

# Ethics, Privacy and Security
## Ethical Considerations
There are a number of ethical concerns that need to be considered when developing and deploying a machine learning algorithm that predicts if an individual is depressed. First, it is important to consider the potential impact of false positives and false negatives. If the algorithm incorrectly predicts that an individual is depressed, this could lead to them being unnecessarily treated or stigmatized. On the other hand, if the algorithm fails to predict that an individual is depressed, this could result in them not receiving the help they need.

## Privacy Concerns
### Access and use
Whether we got permission and notified every respondent before using their information is essential, especially under legislation in different states. Also, our model requires access to many respondents’ data, and we need to prevent the data from being used in different ways over time.

### Re-identification
Another concern with healthcare data is whether we can protect patients’ information. A lot of research shows that people can use different techniques to re-identify individuals in the data. However, on the other hand, too much de-identification may diminish the clinical utility of the data, but too little de-identification may lead to a breach of privacy. [@concerns]

## Security concerns
If the algorithm is made public via a data leak, then anyone could use it to find out which individuals are more likely to be depressed. This information could be used to target those individuals with ads or content that exploits their vulnerabilities. For example, an advertiser could show ads for antidepressant medications to someone who is predicted to be depressed.

### Steps to secure data
The steps we can take to maintain integrity and confidentiality is making sure that only authorized users have access to the data. To do that, we can:

- Make the GitHub repository private. That way only authorized people have access (group members)
- Password can protect our data- with a password that is only distributed to the users who are authorized access
- To protect the integrity of the data, we can make sure only to have information that is needed for this analysis, as well as not re-identifying the data (which is mentioned in privacy concerns)

# Exploratory Data Analysis
- Revise the style and content of the EDA section from the Phase 1 group report in response to the feedback you received about that report

- Select a subset of the results from the Phase 1 group report. You do not need to include every plot from the EDA assignment. You may want to choose particular plots that turned out to be most relevant for the detailed analysis.

- A few summary tables and/or plots, each describing one, two or three variables in the data that you thought were interesting, or were relevant for the detailed analysis

- Tables can be summary statistics of individual variables, contingency tables for pairs of categorical variables, or results tables for basic analyses

- Explain the definitions of the variables in each table/plot

- Comment on the main features of each plot

- Include suitable labels and keys for each plot

- Make sure all plots would be readable if printed in black & white, and adjust the point sizes and/or line thicknesses to improve readability

- Lay out all tables so that they are clearly readable and clearly labelled, and do not use excessive significant figures

####################################################################################

There are 26473 observations and 29 variables in our data set. Out of those 29 features, 28 are explanatory variables, and the other 2 are our target variable and unique id for each respondent. Due to the way the NHANES data was encoded, all variables are currently considered to be numeric even though some of these variables are actually categorical. This will need to be changed before we start our modeling. We have 15 numerical and 12 categorical variables, and the actual numerical variables are; "age", "family_PIR", "sleep_hours", "drinks_per_occasion", "SMD030", "SMD641", "SMD650", "SMD630", "WHD010", "WHD020", "WHD050", "WHD110", "WHD120", "WHD140", "WHQ150".

All the variables apart from result, age, gender, and race have missing values. Imputation of some form will be used to deal with this before we start building our model.




## Summary Tabl
### Categorical Summary
![Bar plot for target variable - depression](../Output/imbalanced.png)

### Numerical Summary

## Correlation Matrix and plot

## Pairs Plot


# Detailed Analysis Results

# Conclusions and Recommendations

# Reference List


